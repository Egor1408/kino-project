(this["webpackJsonpkino-project"]=this["webpackJsonpkino-project"]||[]).push([[0],{140:function(e,t,a){e.exports=a(229)},145:function(e,t,a){},198:function(e,t,a){},219:function(e,t,a){},222:function(e,t,a){},228:function(e,t,a){},229:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),s=a(15),c=a.n(s),i=a(26),o=a.n(i),u=a(41),l=a(109),h=a(39),p=a(42),v=a(47),m=a(46),g=a(240),d=a(95),f=a(236),b=a(66),S=a(241),E=a(235),R=a(238),y=a(239),O=a(234),j=a(237),k=(a(145),E.a.Text),P=E.a.Title,w=function(e){Object(v.a)(a,e);var t=Object(m.a)(a);function a(){return Object(h.a)(this,a),t.apply(this,arguments)}return Object(p.a)(a,[{key:"render",value:function(){var e=this.props,t=e.poster,a=e.title,r=e.release,s=e.genres,c=e.description,i=e.rateMovie,o=e.filmId,u=e.averageRating,l=e.rating,h=s.map((function(e,t){return n.a.createElement(k,{code:!0,key:t}," ",e)})),p=n.a.createElement("div",{className:"noImage"},n.a.createElement("span",null,"No Image"),n.a.createElement(j.a,null));t&&(p=n.a.createElement("img",{src:"http://image.tmdb.org/t/p/w185".concat(t),alt:"poster"}));var v=null;v=u>=7?"#66e900":u>=5?"#e9d100":u>=3?"#e97e00":"#e90000";var m=r?Object(O.a)(new Date(r),"MMMM d, yyyy"):null;return n.a.createElement(R.a,null,n.a.createElement("div",{className:"poster"},p),n.a.createElement("div",{className:"description"},n.a.createElement("div",{className:"title"},n.a.createElement(P,{level:4},a)),n.a.createElement("div",{className:"vote-average",style:{borderColor:v}},n.a.createElement("span",null,u)),n.a.createElement("div",{className:"date"},n.a.createElement(k,{type:"secondary"},m)),n.a.createElement("div",{className:"genres"},h),n.a.createElement("div",{className:"overview"},n.a.createElement(k,{strong:!0},c)),n.a.createElement("div",{className:"rate"},n.a.createElement(y.a,{allowHalf:!0,count:"10",defaultValue:l,style:{fontSize:14},onChange:function(e){i(e,o)}}))))}}]),a}(r.Component);w.defaultProps={rating:0},w.defaultProps={id:0,averageRating:0,poster:null,title:null,release:null,genres:[],description:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442",rating:0};var T=a(137),x=(a(198),function(e){var t=e.totalMovieResults,a=e.nextPage,r=e.loadMovieList,s=e.activeTab,c=e.currentPage;return r&&t>20?n.a.createElement(T.a,{current:c,total:t,pageSize:"20",onChange:function(e){a(s,e)}}):null}),L=function(e){Object(v.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(h.a)(this,a);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))).state={hasError:!1},e}return Object(p.a)(a,[{key:"componentDidCatch",value:function(e,t){this.setState({hasError:!0})}},{key:"render",value:function(){return this.state.hasError?n.a.createElement("h1",null,"Something wrong"):this.props.children}}]),a}(r.Component),M=a(131),_=function(){return n.a.createElement(M.a,{size:"large"})},N=(a(219),a(108),function(e){Object(v.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(h.a)(this,a);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))).state={hasError:!1},e}return Object(p.a)(a,[{key:"componentDidCatch",value:function(){this.setState({hasError:!0})}},{key:"render",value:function(){var e=this,t=this.props,a=t.moviesList,r=t.currentPage,s=t.loadMovieList,c=t.nextPage,i=t.column,o=t.hasError,u=t.totalResults,l=t.searchTerm,h=t.activeTab,p=a.map((function(e){return{id:e.id,poster:e.poster,rating:e.rating,title:e.title,description:e.description,release:e.release,genres:e.genres,averageRating:e.averageRating}}));return o?n.a.createElement(g.a,{status:"warning",title:"There are some problems with your internet."}):l||"1"!==h?s&&0!==u?n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"movie-list"},n.a.createElement(S.b,{grid:{gutter:20,column:i},dataSource:p,renderItem:function(t){return n.a.createElement(S.b.Item,null,n.a.createElement(L,{key:t.id},n.a.createElement(w,{filmId:t.id,poster:t.poster,title:t.title,release:t.release,description:t.description,genres:t.genres,averageRating:t.averageRating,rating:t.rating,rateMovie:e.props.rateMovie})))}})),n.a.createElement(x,{totalMovieResults:u,currentPage:r,loadMovieList:s,nextPage:c,activeTab:h})):!u&&s&&"1"===h?n.a.createElement(b.a,{description:"\u041f\u043e\u0438\u0441\u043a \u043d\u0435 \u0434\u0430\u043b \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432"}):!u&&s&&"2"===h?n.a.createElement(b.a,{description:"\u0412\u044b \u043d\u0435 \u043e\u0446\u0435\u043d\u0438\u043b\u0438 \u043d\u0438 \u043e\u0434\u043d\u043e\u0433\u043e \u0444\u0438\u043b\u044c\u043c\u0430"}):n.a.createElement(_,null):n.a.createElement(b.a,{description:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0444\u0438\u043b\u044c\u043c\u0430"})}}]),a}(r.Component)),D=(a(222),d.a.TabPane),I=f.a.Search,C=function(e){Object(v.a)(a,e);var t=Object(m.a)(a);function a(){return Object(h.a)(this,a),t.apply(this,arguments)}return Object(p.a)(a,[{key:"componentDidMount",value:function(){this.inputRef.focus()}},{key:"render",value:function(){var e=this,t=this.props,a=t.searchTerm,r=t.searchMoviesList,s=t.loadSearchList,c=t.totalSearchResults,i=t.currentSearchPage,o=t.ratedMoviesList,u=t.currentRatedPage,l=t.loadRatedList,h=t.totalRatedResults,p=t.rateMovie,v=t.column,m=t.nextPage,g=t.activeTab,f=t.changeSearchInput;return n.a.createElement("div",{className:"TabPanel"},n.a.createElement(d.a,{className:"tabs",defaultActiveKey:"1",onChange:function(t){e.props.changeTab(t)}},n.a.createElement(D,{tab:"Search",key:"1"},n.a.createElement(I,{ref:function(t){return e.inputRef=t},className:"search",placeholder:"Search movie",onChange:function(e){return f(e.target.value)}}),n.a.createElement(N,{activeTab:g,column:v,currentPage:i,searchTerm:a,loadMovieList:s,totalResults:c,moviesList:r,rateMovie:p,nextPage:m})),n.a.createElement(D,{tab:"Rated",key:"2"},n.a.createElement(N,{activeTab:g,column:v,moviesList:o,currentPage:u,loadMovieList:l,totalResults:h,rateMovie:p,nextPage:m}))))}}]),a}(r.Component),q=function e(){Object(h.a)(this,e),this.mergeData=function(){var e=Object(u.a)(o.a.mark((function e(t,a){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object.keys(t).map((function(e){return a.hasOwnProperty(e)?a[e]:t[e]})),e.abrupt("return",r);case 2:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.arrayToObject=function(e){var t={};return e.forEach((function(e){t[e.id]=e})),t},this.formatMovieData=function(){var e=Object(u.a)(o.a.mark((function e(t,a){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={},Object.values(t).map((function(e){var t=e.genre_ids.slice(0,2).map((function(e){return a[e]})).filter((function(e){return e})).map((function(e){return e.name}));return r[e.id]={id:e.id,title:e.title||e.name||"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442",genres:t,description:e.overview||"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442",poster:e.poster_path,background:e.backdrop_path,release:e.release_date,presonalRating:e.rating||0,averageRating:e.vote_average||0,rating:e.rating||0},r})),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},J=function(){function e(){var t=this;Object(h.a)(this,e),this._apiKey="?api_key=3b74691a96811eecae740c01bb3dfeb1",this._apiBase="https://api.themoviedb.org/3",this.formatData=new q,this.getGenres=Object(u.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getRequest("/genre/movie/list".concat(t._apiKey,"&language=ru")).then((function(e){var a=e.genres;return t.formatData.arrayToObject(a)}));case 2:return t.genres=e.sent,e.abrupt("return",t.genres);case 4:case"end":return e.stop()}}),e)}))),this.getRated=function(){var e=Object(u.a)(o.a.mark((function e(a){var r,n,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=JSON.parse(sessionStorage.getItem("session"))){e.next=3;break}return e.abrupt("return",{movies:[],currentPage:1,totalPages:1});case 3:return e.next=5,t.getRequest("/guest_session/".concat(r.token,"/rated/movies").concat(t._apiKey,"&page=").concat(a,"&language=ru&sort_by=created_at.asc"));case 5:return n=e.sent,e.next=8,t.formatData.formatMovieData(n.results,t.genres);case 8:return s=e.sent,e.abrupt("return",{movies:s,currentPage:n.page,totalResults:n.total_results});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.searchMovies=function(){var e=Object(u.a)(o.a.mark((function e(a,r){var n,s,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getRated(1);case 2:return e.next=4,e.sent.movies;case 4:return n=e.sent,e.next=7,t.getRequest("/search/movie".concat(t._apiKey,"&language=ru&query=").concat(a,"&page=").concat(r,"&include_adult=false"));case 7:return s=e.sent,e.next=10,t.formatData.formatMovieData(s.results,t.genres).then((function(e){return t.formatData.mergeData(e,n)}));case 10:return c=e.sent,e.abrupt("return",{movies:c,currentPage:s.page,totalResults:s.total_results});case 12:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.initguestSession=Object(u.a)(o.a.mark((function e(){var a,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getRequest("/authentication/guest_session/new".concat(t._apiKey));case 2:a=e.sent,r={token:a.guest_session_id,expiry:a.expires_at},sessionStorage.setItem("session",JSON.stringify(r));case 5:case"end":return e.stop()}}),e)}))),this.setRating=function(){var e=Object(u.a)(o.a.mark((function e(a,r,n){var s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getRequest("/movie/".concat(a,"/rating").concat(t._apiKey,"&guest_session_id=").concat(r),{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}()}return Object(p.a)(e,[{key:"getRequest",value:function(){var e=Object(u.a)(o.a.mark((function e(t){var a,r,n,s=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>1&&void 0!==s[1]?s[1]:null,e.next=3,fetch("".concat(this._apiBase).concat(t),a);case 3:if((r=e.sent).ok){e.next=6;break}throw new Error("Could not fetch ".concat(t,", received ").concat(r.status," "));case 6:return e.next=8,r.json();case 8:return n=e.sent,e.abrupt("return",n);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();J.genres={};var K=a(136),A=(a(228),function(e){Object(v.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(h.a)(this,a);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))).state={searchTerm:"",searchMoviesList:[],currentSearchPage:1,loadSearchList:!1,totalSearchResults:0,ratedMoviesList:[],currentRatedPage:1,loadRatedList:!1,totalRatedResults:0,activeTab:"1",column:2,hasError:!1},e.apiService=new J,e.ratedList=function(t){e.apiService.getRated(t).then((function(t){var a=Object.values(t.movies).map((function(e){return e}));e.setState({ratedMoviesList:a,totalRatedResults:t.totalResults,loadRatedList:!0})})).catch(e.onError)},e.searchList=function(t,a){e.apiService.searchMovies(t,a).then((function(t){e.setState({searchMoviesList:t.movies,totalSearchResults:t.totalResults,loadSearchList:!0})})).catch(e.onError)},e.checkWidth=function(){document.documentElement.clientWidth<800&&e.setState({column:1})},e.nextPage=function(t,a){var r="1"===t?"currentSearchPage":"currentRatedPage";e.setState(Object(l.a)({},r,a))},e.changeSearchInput=Object(K.debounce)((function(t){e.setState({searchTerm:t,currentSearchPage:1})}),1500),e.changeTab=function(t){e.setState({activeTab:t})},e.onError=function(){e.setState({hasError:!0})},e.setRating=function(){var t=Object(u.a)(o.a.mark((function t(a,r){var n;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=JSON.parse(sessionStorage.getItem("session")).token,t.next=3,e.movieApi.setRating(r,n,{value:a});case 3:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),e.rateMovie=function(){var t=Object(u.a)(o.a.mark((function t(a,r){var n;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=JSON.parse(sessionStorage.getItem("session")).token,t.next=3,e.apiService.setRating(r,n,{value:a}).catch(e.onError);case 3:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),e}return Object(p.a)(a,[{key:"componentDidMount",value:function(){this.checkWidth(),this.apiService.getGenres(),sessionStorage.getItem("session")||this.apiService.initguestSession()}},{key:"componentDidUpdate",value:function(e,t){(this.state.searchTerm!==t.searchTerm&&""!==this.state.searchTerm||this.state.activeTab!==t.activeTab&&""!==this.state.searchTerm)&&(this.setState({loadSearchList:!1}),this.searchList(this.state.searchTerm,this.state.currentSearchPage)),this.state.currentSearchPage!==t.currentSearchPage&&(this.setState({loadSearchList:!1}),this.searchList(this.state.searchTerm,this.state.currentSearchPage)),this.state.activeTab!==t.activeTab&&(this.setState({loadRatedList:!1}),this.ratedList(this.state.currentRatedPage)),this.state.currentRatedPage!==t.currentRatedPage&&(this.setState({loadRatedList:!1}),this.ratedList(this.state.currentRatedPage))}},{key:"componentDidCatch",value:function(){this.setState({hasError:!0})}},{key:"render",value:function(){return this.state.hasError?n.a.createElement(g.a,{status:"warning",title:"There are some problems with your internet."}):n.a.createElement(L,null,n.a.createElement("div",{className:"wrapper"},n.a.createElement(C,{column:this.state.column,searchTerm:this.state.searchTerm,searchMoviesList:this.state.searchMoviesList,loadSearchList:this.state.loadSearchList,currentSearchPage:this.state.currentSearchPage,totalSearchResults:this.state.totalSearchResults,ratedMoviesList:this.state.ratedMoviesList,currentRatedPage:this.state.currentRatedPage,loadRatedList:this.state.loadRatedList,totalRatedResults:this.state.totalRatedResults,rateMovie:this.rateMovie,nextPage:this.nextPage,changeSearchInput:this.changeSearchInput,changeTab:this.changeTab,activeTab:this.state.activeTab})))}}]),a}(r.Component)),z=document.getElementById("root");c.a.render(n.a.createElement(A,null),z)}},[[140,1,2]]]);
//# sourceMappingURL=main.a3ab9554.chunk.js.map